# 权限控制规范

## 预览模式实现方案

### 1. 核心概念
- **预览模式**: 用户未登录时可浏览部分公共内容
- **完整模式**: 用户登录后可使用全部功能

### 2. 全局状态管理
```javascript
// app.js 中定义全局状态
App({
  globalData: {
    userInfo: null,
    openid: null,
    isPreviewMode: false, // 预览模式标志
  }
})
```

### 3. 页面访问权限

#### 允许预览的页面（无需登录）
- `/pages/index/index` - 首页
- `/pages/recipe-list/recipe-list` - 菜谱列表
- `/pages/recipe-detail/recipe-detail` - 菜谱详情
- `/pages/search/search` - 搜索页面

#### 需要登录的页面
- `/pages/profile/profile` - 个人中心
- `/pages/friends/friends` - 好友页面
- `/pages/friend-requests/friend-requests` - 好友请求
- `/pages/order/order` - 下单页面
- `/pages/order-list/order-list` - 订单列表
- `/pages/recipe-form/recipe-form` - 发布菜谱

### 4. 权限检查逻辑

#### 页面入口检查
```javascript
// 在需要登录的页面 onLoad 中检查
onLoad: function() {
  const app = getApp()
  if (!app.globalData.userInfo && !app.globalData.isPreviewMode) {
    wx.redirectTo({ url: '/pages/login/login' })
    return
  }
  
  if (app.globalData.isPreviewMode) {
    // 显示预览模式提示
    this.setData({ isPreview: true })
  }
}
```

#### 功能级别检查
```javascript
// 在需要登录的功能处检查
handleFunction: function() {
  const app = getApp()
  if (!app.globalData.userInfo) {
    if (app.globalData.isPreviewMode) {
      wx.showModal({
        title: '提示',
        content: '该功能需要登录后使用',
        confirmText: '立即登录',
        success: (res) => {
          if (res.confirm) {
            wx.navigateTo({ url: '/pages/login/login' })
          }
        }
      })
    } else {
      wx.navigateTo({ url: '/pages/login/login' })
    }
    return
  }
  
  // 正常执行功能
}
```

### 5. 登录页面实现

#### 添加"暂不登录"按钮
```wxml
<button class="preview-btn" bindtap="enterPreviewMode">
  暂不登录，先看看
</button>
```

#### 预览模式入口逻辑
```javascript
enterPreviewMode: function() {
  const app = getApp()
  app.globalData.isPreviewMode = true
  
  // 跳转到首页
  wx.switchTab({
    url: '/pages/index/index'
  })
}
```

### 6. 界面提示规范

#### 预览模式提示条
在预览模式下，在页面顶部显示提示：
```
预览模式 · 部分功能受限 · [立即登录]
```

#### 受限功能提示
- 收藏按钮: "登录后收藏"
- 下单按钮: "登录后下单"
- 个人中心: "登录查看个人资料"

### 7. 退出预览模式
用户在任何时候点击登录后，自动退出预览模式：
```javascript
app.globalData.isPreviewMode = false
```

### 8. 注意事项
1. 预览模式数据不持久化，关闭小程序后失效
2. 确保预览模式下不会产生脏数据
3. 提供清晰的登录引导
4. 保持用户体验的一致性

### 9. 后续扩展
- 可考虑增加游客模式，允许有限度的交互
- 添加数据统计，了解预览用户的转化率