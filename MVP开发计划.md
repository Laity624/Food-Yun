# 家庭菜谱管理小程序 MVP 开发计划

## 项目概述
开发一个功能完整的家庭菜谱管理小程序MVP版本。

## 技术栈选择

### 前端（小程序）
- **框架**: 微信小程序原生开发
- **UI库**: Vant Weapp (轻量级组件库)
- **状态管理**: 小程序全局数据
- **云开发SDK**: @cloudbase/js-sdk
- **工具**: 微信开发者工具

### 后端（云开发）
- **云函数**: Node.js 运行时
- **云数据库**: MongoDB 文档数据库
- **云存储**: 自动CDN加速的文件存储
- **认证**: 微信云开发登录
- **部署**: 一键发布，无需服务器运维

### 架构优势
- **零运维**: 无需管理服务器和数据库
- **自动扩容**: 根据使用量自动伸缩
- **成本低**: 按量付费，初期基本免费
- **集成度高**: 与小程序天然集成

## MVP功能范围

### 核心功能 (必须实现)
1. **用户管理**
   - 微信登录
   - 用户信息管理
   - 好友添加管理（双向确认）

2. **菜谱管理**
   - 菜谱创建 (基础信息 + 图片)
   - 菜谱列表展示
   - 菜谱详情查看
   - 菜谱编辑/删除

3. **搜索功能**
   - 菜谱名称搜索
   - 简单分类筛选

4. **点餐功能**
   - 餐次选择 (早/中/晚餐)
   - 菜品选择（从好友菜谱中选择）
   - 订单提交和查看

5. **好友管理**
   - 搜索添加好友
   - 好友请求管理
   - 好友列表查看
   - 好友关系维护

### 暂缓功能 (后续版本)
- 视频上传
- 复杂的营养分析
- 高级搜索筛选
- 消息推送
- 数据统计

## 开发阶段规划

### 第一阶段：云开发环境搭建 (1天)
- [x] 制定开发计划
- [ ] 创建微信云开发环境
- [ ] 搭建小程序基础框架 + 云开发SDK
- [ ] 配置云开发权限和安全规则
- [ ] 初始化云数据库集合

### 第二阶段：云函数开发 (2天)
- [ ] 用户登录云函数 (替代auth接口)
- [ ] 菜谱管理云函数 (替代recipe接口)
- [ ] 订单管理云函数 (替代order接口)
- [ ] 用户信息云函数 (替代user接口)
- [ ] 好友管理云函数 (好友添加/确认/列表)

### 第三阶段：小程序页面开发 (3天) 
- [ ] 首页 + 底部导航
- [ ] 菜谱列表和详情页 (集成云数据库查询)
- [ ] 添加/编辑菜谱页 (集成云存储上传)
- [ ] 搜索页面 (云数据库模糊查询)
- [ ] 点餐页面 (从好友菜谱中选择)
- [ ] 好友管理页面 (添加/确认/列表)
- [ ] 个人中心 (云开发登录状态)

### 第四阶段：功能集成 (1天)
- [ ] 小程序与云函数联调
- [ ] 云数据库权限配置
- [ ] 云存储安全规则设置
- [ ] 端到端功能测试

### 第五阶段：优化完善 (1天)
- [ ] UI细节优化
- [ ] 性能优化
- [ ] 错误处理
- [ ] 用户体验完善

## 数据库设计 (简化版)

### 用户表 (users)
```javascript
{
  _id: ObjectId,
  openid: String,
  nickname: String,
  avatar: String,
  searchCode: String, // 用于好友搜索的唯一码
  createdAt: Date
}
```

### 菜谱表 (recipes)
```javascript
{
  _id: ObjectId,
  title: String,
  description: String,
  image: String,
  ingredients: [String],
  steps: [String],
  cookTime: Number,
  difficulty: String,
  category: String,
  creatorId: ObjectId,
  isPublic: Boolean, // 是否公开给好友
  createdAt: Date
}
```

### 订单表 (orders)
```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  mealType: String, // 'breakfast' | 'lunch' | 'dinner'
  orderDate: Date,
  recipes: [ObjectId],
  status: String, // 'pending' | 'cooking' | 'completed'
  notes: String,
  createdAt: Date
}
```

### 好友关系表 (friendships)
```javascript
{
  _id: ObjectId,
  requesterId: ObjectId, // 发起好友请求的用户
  receiverId: ObjectId,  // 接收好友请求的用户
  status: String,        // 'pending' | 'confirmed' | 'blocked'
  createdAt: Date,
  confirmedAt: Date
}
```

## 云开发服务设计

### 云函数
- `login` - 用户登录认证
- `user` - 用户信息管理 (获取/更新用户资料)
- `recipe` - 菜谱管理 (CRUD操作 + 搜索)
- `order` - 订单管理 (创建/查询/更新订单)
- `friend` - 好友管理 (添加/确认/列表/删除好友)

### 云数据库集合
- `users` - 用户信息
- `recipes` - 菜谱数据
- `orders` - 订单记录
- `friendships` - 好友关系

### 云存储
- 直接使用 `wx.cloud.uploadFile()` 上传图片
- 自动获得CDN加速的访问链接
- 无需额外配置文件服务器

### 调用方式
```javascript
// 调用云函数
wx.cloud.callFunction({
  name: 'recipe',
  data: { action: 'list', page: 1 }
})

// 上传文件
wx.cloud.uploadFile({
  cloudPath: 'recipes/' + Date.now() + '.jpg',
  filePath: tempFilePath
})
```

## 小程序页面结构

```
pages/
├── index/              # 首页
├── recipe-list/        # 菜谱列表
├── recipe-detail/      # 菜谱详情
├── recipe-form/        # 添加/编辑菜谱
├── search/             # 搜索页面
├── order/              # 点餐页面
├── order-list/         # 订单列表
├── friends/            # 好友管理页面
├── friend-requests/    # 好友请求页面
└── profile/            # 个人中心

components/
├── recipe-card/        # 菜谱卡片组件
├── bottom-nav/         # 底部导航组件
├── friend-card/        # 好友卡片组件
└── loading/            # 加载组件
```

## 开发注意事项

### 小程序端
1. 使用 Vant Weapp 组件库提升开发效率
2. 合理使用小程序的生命周期
3. 做好错误处理和加载状态
4. 优化图片加载和缓存

### 云开发
1. 合理设计云函数，避免冷启动
2. 配置数据库安全规则（特别注意好友关系权限）
3. 优化云存储文件结构
4. 做好错误处理和日志记录
5. 好友关系查询优化（避免N+1查询问题）

### 通用
1. 前后端数据格式统一
2. 错误码和提示信息规范
3. 开发阶段使用本地存储，便于调试
4. 预留扩展接口，便于后续功能添加

## 成功标准

MVP版本完成后应该能够：
1. ✅ 用户可以正常登录和管理个人信息
2. ✅ 用户可以创建、查看、编辑菜谱
3. ✅ 用户可以搜索和浏览菜谱
4. ✅ 用户可以添加和管理好友关系
5. ✅ 好友间可以进行点餐操作
6. ✅ 基本的订单管理功能正常
7. ✅ 所有页面UI与设计图基本一致
8. ✅ 核心功能流程完整可用

---

**预计总开发时间**: 8天  
**开始时间**: 2025-09-15  
**目标完成时间**: 2025-09-23



## 部署方案：微信云开发 (最终选择)

### 云开发优势
- **零成本起步**: 免费额度足够MVP使用
- **零运维**: 无需管理服务器、数据库
- **一键部署**: 微信开发者工具直接上传
- **天然集成**: 与小程序完美配合
- **自动扩容**: 根据用户量自动调整资源

### 成本预估
- **免费额度**: 
  - 云函数调用: 100万次/月
  - 数据库读写: 5万次/月  
  - 云存储: 5GB
  - CDN流量: 5GB/月
- **超出费用**: 按量付费，预估¥10-50/月

### 部署步骤
1. 在微信开发者工具中开通云开发
2. 上传云函数代码
3. 配置数据库集合和权限
4. 小程序代码一键预览/发布

### vs 传统服务器方案对比
| 项目 | 传统方案 | 云开发方案 |
|------|---------|-----------|
| 服务器成本 | ¥39+/月 | 免费起步 |
| 数据库 | 需配置维护 | 开箱即用 |
| 文件存储 | 需配置CDN | 自动CDN |
| 运维难度 | 需要技术知识 | 零运维 |
| 扩展性 | 手动扩容 | 自动扩容 |
| 小程序审核 | 需要域名备案 | 天然通过 |