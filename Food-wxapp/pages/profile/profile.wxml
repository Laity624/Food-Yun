<view class="container">
  <!-- ç™»å½•æç¤ºç»„ä»¶ -->
  <login-prompt 
    id="loginPrompt"
    visible="{{showLoginPrompt}}"
    content="{{promptContent}}"
    bind:close="onPromptClose"
    bind:login="onPromptLogin"
  />

  <!-- å¤´éƒ¨æ¸å˜èƒŒæ™¯ -->
  <view class="gradient-header">
    <!-- è£…é¥°æ€§èƒŒæ™¯å…ƒç´  -->
    <view class="decorative-circle circle-1"></view>
    <view class="decorative-circle circle-2"></view>
    

    <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
    <view class="user-info-section">
      <view class="avatar-section">
        <image class="user-avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}" bindtap="onAvatarClick"></image>
        <view class="online-status"></view>
      </view>
      
      <view class="user-details">
        <view class="name-section">
          <text class="user-name">{{userInfo.nickname || 'æœªç™»å½•ç”¨æˆ·'}}</text>
          <view class="vip-badge" wx:if="{{userInfo.vipLevel}}">VIP</view>
          <text class="edit-nickname-btn" bindtap="onEditNickname" wx:if="{{!isPreviewMode}}">âœï¸</text>
        </view>
        
        <text class="user-bio" wx:if="{{userInfo.bio}}">{{userInfo.bio}}</text>
        
        <view class="stats-section">
          <view class="stat-item">
            <text class="stat-number">{{userInfo.recipeCount || 0}}</text>
            <text class="stat-label">èœè°±</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{userInfo.friendCount || 0}}</text>
            <text class="stat-label">å¥½å‹</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{userInfo.likeCount || 0}}</text>
            <text class="stat-label">è·èµ</text>
          </view>
        </view>
      </view>

      <view class="header-buttons">
        <view class="header-btn" bindtap="onNotifications">
          <text class="icon">ğŸ””</text>
        </view>
        <view class="header-btn" bindtap="onSettings">
          <text class="icon">âš™ï¸</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç å¡ç‰‡ -->
    <view class="search-code-card" wx:if="{{userInfo.searchCode}}">
      <view class="search-code-left">
        <view class="qr-icon">
          <text class="icon">ğŸ“±</text>
        </view>
        <view class="search-code-info">
          <text class="search-code-title">æˆ‘çš„æœç´¢ç </text>
          <text class="search-code-value">{{userInfo.searchCode}}</text>
        </view>
      </view>
      <view class="search-code-actions">
        <view class="action-btn" bindtap="onCopySearchCode">
          <text class="icon">ğŸ“‹</text>
        </view>
        <view class="action-btn" bindtap="onShareSearchCode">
          <text class="icon">ğŸ“¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <!-- å¿«æ·åŠŸèƒ½ç½‘æ ¼ -->
    <view class="quick-actions-grid">
      <view class="quick-action" bindtap="onMyRecipes">
        <view class="action-icon recipes">
          <text class="icon">ğŸ“–</text>
        </view>
        <text class="action-label">æˆ‘çš„èœè°±</text>
      </view>
      <view class="quick-action" bindtap="onMyOrders">
        <view class="action-icon orders">
          <text class="icon">ğŸ“‹</text>
        </view>
        <text class="action-label">æˆ‘çš„è®¢å•</text>
      </view>
      <view class="quick-action" bindtap="onMyFavorites">
        <view class="action-icon favorites">
          <text class="icon">â¤ï¸</text>
        </view>
        <text class="action-label">æˆ‘çš„æ”¶è—</text>
      </view>
      <view class="quick-action" bindtap="onStatistics">
        <view class="action-icon statistics">
          <text class="icon">ğŸ“Š</text>
        </view>
        <text class="action-label">æ•°æ®ç»Ÿè®¡</text>
      </view>
    </view>

    <!-- èœå•åˆ—è¡¨ -->
    <view class="menu-list">
      <view class="menu-item" bindtap="onMyRecipes">
        <view class="menu-item-left">
          <view class="menu-icon recipes">
            <text class="icon">ğŸ“–</text>
          </view>
          <text class="menu-text">æˆ‘çš„èœè°±</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-count" wx:if="{{userInfo.recipeCount > 0}}">{{userInfo.recipeCount}}</text>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-item" bindtap="onFriends">
        <view class="menu-item-left">
          <view class="menu-icon friends">
            <text class="icon">ğŸ‘¥</text>
          </view>
          <text class="menu-text">å¥½å‹ç®¡ç†</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-count" wx:if="{{userInfo.friendCount > 0}}">{{userInfo.friendCount}}</text>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-item" bindtap="onFavorites">
        <view class="menu-item-left">
          <view class="menu-icon favorites">
            <text class="icon">â¤ï¸</text>
          </view>
          <text class="menu-text">æˆ‘çš„æ”¶è—</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-count" wx:if="{{userInfo.favoriteCount > 0}}">{{userInfo.favoriteCount}}</text>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-item" bindtap="onSettings">
        <view class="menu-item-left">
          <view class="menu-icon settings">
            <text class="icon">âš™ï¸</text>
          </view>
          <text class="menu-text">è®¾ç½®</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-item" bindtap="onHelp">
        <view class="menu-item-left">
          <view class="menu-icon help">
            <text class="icon">â“</text>
          </view>
          <text class="menu-text">å¸®åŠ©ä¸­å¿ƒ</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-item" bindtap="onAbout">
        <view class="menu-item-left">
          <view class="menu-icon about">
            <text class="icon">â„¹ï¸</text>
          </view>
          <text class="menu-text">å…³äºæˆ‘ä»¬</text>
        </view>
        <view class="menu-item-right">
          <text class="menu-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
    <view class="logout-section" wx:if="{{userInfo._id}}">
      <button class="logout-btn" bindtap="onLogout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- æ˜µç§°ç¼–è¾‘æ¨¡æ€æ¡† -->
  <view class="modal-mask" wx:if="{{showNicknameModal}}" bindtap="onCloseModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘æ˜µç§°</text>
      </view>
      <view class="modal-body">
        <input 
          class="nickname-input" 
          type="text" 
          placeholder="è¯·è¾“å…¥æ˜µç§°" 
          maxlength="10" 
          value="{{editingNickname}}" 
          bindinput="onNicknameInput"
          focus="{{showNicknameModal}}"
        />
        <view class="nickname-counter">{{editingNickname.length}}/10</view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="onCloseModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="onUpdateNickname">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
