<view class="container">
  <!-- 搜索和筛选栏 -->
  <view class="search-filter-bar">
    <view class="search-section">
      <view class="search-input-wrapper {{showSearch ? 'expanded' : ''}}">
        <input 
          wx:if="{{showSearch}}"
          class="search-input" 
          placeholder="搜索菜谱名称..."
          value="{{searchValue}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          focus="{{showSearch}}"
        />
        <view wx:else class="search-placeholder" bindtap="onSearchClick">
          <text class="search-icon">🔍</text>
          <text class="search-text">搜索菜谱</text>
        </view>
        <view wx:if="{{showSearch}}" class="search-actions">
          <text class="search-action" bindtap="onSearchConfirm">搜索</text>
          <text class="search-action cancel" bindtap="onSearchClear">取消</text>
        </view>
      </view>
    </view>
    <view class="filter-section">
      <view class="filter-btn {{selectedTags.length > 0 ? 'active' : ''}}" bindtap="onFilterClick">
        <text class="filter-icon">🏷️</text>
        <text class="filter-text">筛选</text>
        <text wx:if="{{selectedTags.length > 0}}" class="filter-count">{{selectedTags.length}}</text>
      </view>
    </view>
  </view>

  <!-- 选中的标签显示 -->
  <view wx:if="{{selectedTags.length > 0}}" class="selected-tags">
    <view 
      wx:for="{{selectedTags}}" 
      wx:key="*this"
      class="selected-tag"
      data-tag="{{item}}"
      bindtap="onRemoveTag"
    >
      <text>{{item}}</text>
      <text class="remove-icon">×</text>
    </view>
  </view>

  <!-- 标签筛选面板 -->
  <view wx:if="{{showFilter}}" class="filter-panel">
    <view class="filter-header">
      <text class="filter-title">选择标签</text>
      <view class="filter-header-actions">
        <text class="filter-reset" bindtap="onFilterReset">重置</text>
        <text class="filter-confirm" bindtap="onFilterConfirm">确定</text>
      </view>
    </view>
    <scroll-view class="filter-content" scroll-y="true">
      <view wx:for="{{tagOptions}}" wx:key="name" class="tag-category">
        <view class="category-title">{{item.name}}</view>
        <view class="tag-list">
          <view 
            wx:for="{{item.tags}}" 
            wx:for-item="tag"
            wx:key="*this"
            class="tag-item {{selectedTags.indexOf(tag) !== -1 || currentQuickFilter === tag ? 'selected' : ''}}"
            data-tag="{{tag}}"
            bindtap="onTagToggle"
          >
            {{tag}}
            <text wx:if="{{currentQuickFilter === tag}}" class="quick-filter-mark">快</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 快速筛选 -->
  <scroll-view class="category-scroll" scroll-x="true">
    <view class="category-list">
      <view 
        wx:for="{{quickFilters}}" 
        wx:key="name"
        class="category-item {{currentQuickFilter === item.tag ? 'active' : ''}}"
        data-tag="{{item.tag}}"
        bindtap="onQuickFilterChange"
      >
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- 菜谱列表 -->
  <view class="recipe-list">
    <view 
      wx:for="{{recipes}}" 
      wx:key="_id"
      class="recipe-item card"
      data-id="{{item._id}}"
      bindtap="onRecipeClick"
    >
      <image class="recipe-image" src="{{item.images[0] || item.image}}" mode="aspectFill"></image>
      <view class="recipe-content">
        <text class="recipe-title">{{item.title}}</text>
        <text class="recipe-desc">{{item.description}}</text>
        
        <!-- 标签显示 -->
        <view wx:if="{{item.tags && item.tags.length > 0}}" class="recipe-tags">
          <view 
            wx:for="{{item.tags}}" 
            wx:for-item="tag"
            wx:key="*this"
            wx:if="{{index < 3}}"
            class="recipe-tag"
          >
            {{tag}}
          </view>
          <text wx:if="{{item.tags.length > 3}}" class="more-tags">+{{item.tags.length - 3}}</text>
        </view>
        
        <view class="recipe-meta">
          <text class="meta-item">⏱️ {{item.cookTime}}</text>
          <text class="meta-item">🔥 {{item.difficulty}}</text>
          <text class="meta-item">👥 {{item.serving}}</text>
        </view>
        <view class="recipe-footer">
          <view class="creator-info">
            <image class="creator-avatar" src="{{item.creator.avatar}}" mode="aspectFill"></image>
            <text class="creator-name">{{item.creator.nickname}}</text>
          </view>
          <text class="create-time">{{item.createTime}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <!-- 空状态 -->
  <view wx:elif="{{recipes.length === 0}}" class="empty">
    <text class="empty-icon">🍳</text>
    <text class="empty-text">暂无菜谱</text>
    <button class="btn btn-primary" bindtap="onAddClick">添加第一个菜谱</button>
  </view>

  <!-- 没有更多 -->
  <view wx:elif="{{!hasMore}}" class="no-more">
    <text>没有更多了</text>
  </view>

  <!-- 悬浮按钮 -->
  <view class="fab" bindtap="onAddClick">
    <text class="fab-icon">+</text>
  </view>
</view>