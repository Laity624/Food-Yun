<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <view class="search-section">
      <view class="search-input-wrapper {{showSearch ? 'expanded' : ''}}">
        <input 
          wx:if="{{showSearch}}"
          class="search-input" 
          placeholder="æœç´¢èœè°±åç§°..."
          value="{{searchValue}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          focus="{{showSearch}}"
        />
        <view wx:else class="search-placeholder" bindtap="onSearchClick">
          <text class="search-icon">ğŸ”</text>
          <text class="search-text">æœç´¢èœè°±</text>
        </view>
        <view wx:if="{{showSearch}}" class="search-actions">
          <text class="search-action" bindtap="onSearchConfirm">æœç´¢</text>
          <text class="search-action cancel" bindtap="onSearchClear">å–æ¶ˆ</text>
        </view>
      </view>
    </view>
    <view class="filter-section">
      <view class="filter-btn {{selectedTags.length > 0 ? 'active' : ''}}" bindtap="onFilterClick">
        <text class="filter-icon">ğŸ·ï¸</text>
        <text class="filter-text">ç­›é€‰</text>
        <text wx:if="{{selectedTags.length > 0}}" class="filter-count">{{selectedTags.length}}</text>
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­çš„æ ‡ç­¾æ˜¾ç¤º -->
  <view wx:if="{{selectedTags.length > 0}}" class="selected-tags">
    <view 
      wx:for="{{selectedTags}}" 
      wx:key="*this"
      class="selected-tag"
      data-tag="{{item}}"
      bindtap="onRemoveTag"
    >
      <text>{{item}}</text>
      <text class="remove-icon">Ã—</text>
    </view>
  </view>

  <!-- æ ‡ç­¾ç­›é€‰é¢æ¿ -->
  <view wx:if="{{showFilter}}" class="filter-panel">
    <view class="filter-header">
      <text class="filter-title">é€‰æ‹©æ ‡ç­¾</text>
      <view class="filter-header-actions">
        <text class="filter-reset" bindtap="onFilterReset">é‡ç½®</text>
        <text class="filter-confirm" bindtap="onFilterConfirm">ç¡®å®š</text>
      </view>
    </view>
    <scroll-view class="filter-content" scroll-y="true">
      <view wx:for="{{tagOptions}}" wx:key="name" class="tag-category">
        <view class="category-title">{{item.name}}</view>
        <view class="tag-list">
          <view 
            wx:for="{{item.tags}}" 
            wx:for-item="tag"
            wx:key="*this"
            class="tag-item {{selectedTags.indexOf(tag) !== -1 || currentQuickFilter === tag ? 'selected' : ''}}"
            data-tag="{{tag}}"
            bindtap="onTagToggle"
          >
            {{tag}}
            <text wx:if="{{currentQuickFilter === tag}}" class="quick-filter-mark">å¿«</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å¿«é€Ÿç­›é€‰ -->
  <scroll-view class="category-scroll" scroll-x="true">
    <view class="category-list">
      <view 
        wx:for="{{quickFilters}}" 
        wx:key="name"
        class="category-item {{currentQuickFilter === item.tag ? 'active' : ''}}"
        data-tag="{{item.tag}}"
        bindtap="onQuickFilterChange"
      >
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- èœè°±åˆ—è¡¨ -->
  <view class="recipe-list">
    <view 
      wx:for="{{recipes}}" 
      wx:key="_id"
      class="recipe-item card"
      data-id="{{item._id}}"
      bindtap="onRecipeClick"
    >
      <image class="recipe-image" src="{{item.images[0] || item.image}}" mode="aspectFill"></image>
      <view class="recipe-content">
        <text class="recipe-title">{{item.title}}</text>
        <text class="recipe-desc">{{item.description}}</text>
        
        <!-- æ ‡ç­¾æ˜¾ç¤º -->
        <view wx:if="{{item.tags && item.tags.length > 0}}" class="recipe-tags">
          <view 
            wx:for="{{item.tags}}" 
            wx:for-item="tag"
            wx:key="*this"
            wx:if="{{index < 3}}"
            class="recipe-tag"
          >
            {{tag}}
          </view>
          <text wx:if="{{item.tags.length > 3}}" class="more-tags">+{{item.tags.length - 3}}</text>
        </view>
        
        <view class="recipe-meta">
          <text class="meta-item">â±ï¸ {{item.cookTime}}</text>
          <text class="meta-item">ğŸ”¥ {{item.difficulty}}</text>
          <text class="meta-item">ğŸ‘¥ {{item.serving}}</text>
        </view>
        <view class="recipe-footer">
          <view class="creator-info">
            <image class="creator-avatar" src="{{item.creator.avatar}}" mode="aspectFill"></image>
            <text class="creator-name">{{item.creator.nickname}}</text>
          </view>
          <text class="create-time">{{item.createTime}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{recipes.length === 0}}" class="empty">
    <text class="empty-icon">ğŸ³</text>
    <text class="empty-text">æš‚æ— èœè°±</text>
    <button class="btn btn-primary" bindtap="onAddClick">æ·»åŠ ç¬¬ä¸€ä¸ªèœè°±</button>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view wx:elif="{{!hasMore}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>

  <!-- æ‚¬æµ®æŒ‰é’® -->
  <view class="fab" bindtap="onAddClick">
    <text class="fab-icon">+</text>
  </view>
</view>