4. 数据库初始化详细步骤

  步骤1：进入云开发控制台

  1. 打开微信开发者工具
  2. 在工具栏中点击"云开发"按钮
  3. 进入云开发控制台

  步骤2：创建数据库集合

  在云开发控制台的"数据库"页面，依次创建以下集合：

  创建 users 集合（用户信息）

  1. 点击"添加集合"
  2. 集合名称：users
  3. 点击确定创建

  创建 recipes 集合（菜谱数据）

  1. 点击"添加集合"
  2. 集合名称：recipes
  3. 点击确定创建

  创建 orders 集合（订单记录）

  1. 点击"添加集合"
  2. 集合名称：orders
  3. 点击确定创建

  创建 friends 集合（好友关系）

  1. 点击"添加集合"
  2. 集合名称：friends
  3. 点击确定创建

  创建 friend_requests 集合（好友请求）

  1. 点击"添加集合"
  2. 集合名称：friend_requests
  3. 点击确定创建

  步骤3：添加索引（可选，提升查询性能）

  为每个集合添加常用查询字段的索引：

  users集合索引：
  - openid（唯一索引）

  recipes集合索引：
  - creatorId
  - category
  - isPublic

  orders集合索引：
  - userOpenid
  - status
  - createTime

  friends集合索引：
  - userOpenid
  - friendOpenid

  friend_requests集合索引：
  - targetOpenid
  - fromOpenid
  - status

● Todo
  ⎿ ◼ 查找项目文档中的数据库初始化和权限配置部分
    ◼ 提供数据库初始化详细步骤
    ◻ 提供权限配置详细步骤

● 5. 权限配置详细步骤

  步骤1：配置数据库安全规则

  方法一：通过控制台配置

  1. 在云开发控制台中，点击"数据库" → "安全规则"
  2. 为每个集合配置读写权限规则：

  users集合权限：
  {
    "read": "auth.openid == resource.openid",
    "write": "auth.openid == resource.openid"
  }

  recipes集合权限：
  {
    "read": "resource.isPublic == true || resource.creatorId == auth.openid",
    "write": "resource.creatorId == auth.openid"
  }

  orders集合权限：
  {
    "read": "resource.userOpenid == auth.openid",
    "write": "resource.userOpenid == auth.openid"
  }

  friends集合权限：
  {
    "read": "resource.userOpenid == auth.openid || resource.friendOpenid == auth.openid",
    "write": "resource.userOpenid == auth.openid || resource.friendOpenid == auth.openid"
  }

  friend_requests集合权限：
  {
    "read": "resource.fromOpenid == auth.openid || resource.targetOpenid == auth.openid",
    "write": "resource.fromOpenid == auth.openid || resource.targetOpenid == auth.openid"
  }

  方法二：批量导入规则文件

  1. 在云开发控制台的"数据库" → "安全规则"页面
  2. 点击"导入规则"
  3. 选择项目中的 database.rules.json 文件
  4. 点击确认导入

  步骤2：配置云存储安全规则

  在云开发控制台配置：

  1. 点击"存储" → "安全规则"
  2. 配置以下规则：

  // 用户头像目录 - 只允许用户本人读写
  {
    "avatars/{openid}/*": {
      "read": "auth.openid == openid",
      "write": "auth.openid == openid"
    }
  }

  // 菜谱图片目录 - 允许公开读取，只允许创建者写入
  {
    "recipes/{openid}/*": {
      "read": true,
      "write": "auth.openid == openid"
    }
  }

  // 默认规则 - 拒绝所有其他访问
  {
    "*": {
      "read": false,
      "write": false
    }
  }

  步骤3：测试权限配置

  测试数据库权限：

  1. 在云开发控制台的"数据库"页面
  2. 尝试添加测试数据
  3. 使用不同用户身份测试读写权限

  测试存储权限：

  1. 在小程序中测试图片上传功能
  2. 验证文件访问权限是否正确

  步骤4：权限配置验证清单

  ☐ users集合：用户只能读写自己的数据
  ☐ recipes集合：用户只能读取公开菜谱或自己的菜谱，只能写入自己的菜谱
  ☐ orders集合：用户只能读写自己的订单
  ☐ friends集合：用户只能读写与自己相关的好友关系
  ☐ friend_requests集合：用户只能读写与自己相关的好友请求
  ☐ 云存储：用户只能访问自己的文件，菜谱图片可公开读取

● Todo
  ⎿ ◼ 查找项目文档中的数据库初始化和权限配置部分
    ◼ 提供数据库初始化详细步骤
    ◼ 提供权限配置详细步骤

● 重要提醒

  1. 权限配置顺序：建议先部署云函数，再配置数据库权限，最后测试功能
  2. 测试环境：在真机上测试权限配置，开发者工具可能不完全模拟权限验证
  3. 备份规则：配置权限前建议备份现有规则
  4. 逐步配置：建议先配置宽松权限测试功能，再逐步收紧权限



  据你的项目需求，每个集合应该选择以下权限：

  集合权限配置

  users 集合

  选择：2、仅创建者可读写
  - 理由：用户个人信息属于隐私数据，只有用户本人可以读写自己的信息

  recipes 集合

  选择：1、所有用户可读、创建者可读写
  - 理由：菜谱需要被好友查看和搜索，但只有创建者可以修改删除自己的菜谱

  orders 集合

  选择：2、仅创建者可读写
  - 理由：订单信息属于用户隐私，只有下单用户本人可以查看和管理自己的订单

  friends 集合

  选择：5、自定义安全规则
  - 理由：好友关系需要特殊权限控制，只有关系中的两个用户可以读写该好友关系记录

  friend_requests 集合

  选择：5、自定义安全规则
  - 理由：好友请求只有发送者和接收者可以查看，需要自定义权限控制

  自定义安全规则配置

  对于选择了"自定义安全规则"的集合，你需要在创建后进入该集合的权限设置页面，配置具体规则：

  friends集合自定义规则：
  {
    "read": "resource.userOpenid == auth.openid || resource.friendOpenid == auth.openid",
    "write": "resource.userOpenid == auth.openid || resource.friendOpenid == auth.openid"
  }

  friend_requests集合自定义规则：
  {
    "read": "resource.fromOpenid == auth.openid || resource.targetOpenid == auth.openid",
    "write": "resource.fromOpenid == auth.openid || resource.targetOpenid == auth.openid"
  }

  这样配置可以确保数据安全，同时满足应用的功能需求。